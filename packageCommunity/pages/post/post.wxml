<!--packageCommunity/pages/post/post.wxml-->
<view class="container">
  <!-- 顶部导航栏 -->
  <view class="navbar">
    <view class="navbar-left" bindtap="navigateBack">
      <text class="iconfont icon-back"></text>
    </view>
    <view class="navbar-title">发布动态</view>
    <view class="navbar-right">
      <view class="post-btn {{content ? 'active' : ''}}" bindtap="submitPost">发布</view>
    </view>
  </view>
  
  <!-- 内容输入区 -->
  <view class="post-content">
    <textarea class="content-textarea" 
              placeholder="分享你的习惯打卡心得..." 
              maxlength="500" 
              bindinput="inputContent"
              value="{{content}}"
              auto-focus="true"
              show-confirm-bar="false"></textarea>
    
    <view class="word-count">{{content.length}}/500</view>
  </view>
  
  <!-- 已选图片 -->
  <view class="image-list" wx:if="{{images.length > 0}}">
    <view class="image-item" wx:for="{{images}}" wx:key="*this">
      <image class="preview-image" src="{{item}}" mode="aspectFill"></image>
      <view class="remove-image" bindtap="removeImage" data-index="{{index}}">
        <text class="iconfont icon-close"></text>
      </view>
    </view>
    
    <view class="add-image" bindtap="chooseImage" wx:if="{{images.length < 9}}">
      <text class="iconfont icon-add"></text>
    </view>
  </view>
  <view class="add-image-btn" bindtap="chooseImage" wx:if="{{images.length === 0}}">
    <text class="iconfont icon-image"></text>
    <text>添加图片</text>
  </view>
  
  <!-- 习惯关联 -->
  <view class="habit-section">
    <view class="section-title">关联习惯</view>
    <view class="habit-selector" bindtap="showHabitSelector">
      <text wx:if="{{selectedHabit}}">{{selectedHabit.name}}</text>
      <text wx:else class="placeholder">选择要关联的习惯</text>
      <text class="iconfont icon-right"></text>
    </view>
  </view>
  
  <!-- 标签选择 -->
  <view class="tag-section">
    <view class="section-title">添加标签</view>
    
    <!-- 已选标签 -->
    <view class="selected-tags" wx:if="{{tags.length > 0}}">
      <view class="tag-item" wx:for="{{tags}}" wx:key="*this">
        <text>#{{item}}</text>
        <text class="remove-tag" bindtap="removeTag" data-index="{{index}}">×</text>
      </view>
    </view>
    
    <!-- 标签输入 -->
    <view class="tag-input-wrapper">
      <text class="tag-prefix">#</text>
      <input class="tag-input" 
             placeholder="添加标签，按空格或回车确认" 
             value="{{tagInput}}"
             bindinput="inputTag"
             bindconfirm="addTag"
             confirm-type="done" />
    </view>
    
    <!-- 推荐标签 -->
    <view class="tag-recommendations">
      <view class="tag-recommendation" 
            wx:for="{{recommendTags}}" 
            wx:key="*this"
            bindtap="selectRecommendTag"
            data-tag="{{item}}">
        #{{item}}
      </view>
    </view>
  </view>
  
  <!-- 位置信息 -->
  <view class="location-section">
    <view class="location-toggle" bindtap="toggleLocation">
      <text class="iconfont {{showLocation ? 'icon-location-filled' : 'icon-location'}}"></text>
      <text>{{locationName || '添加位置'}}</text>
    </view>
  </view>
</view>

<!-- 习惯选择器弹窗 -->
<view class="habit-modal-mask" wx:if="{{showHabitModal}}" bindtap="hideHabitSelector">
  <view class="habit-modal" catchtap="stopPropagation">
    <view class="habit-modal-header">
      <text class="habit-modal-title">选择习惯</text>
      <text class="habit-modal-close iconfont icon-close" bindtap="hideHabitSelector"></text>
    </view>
    
    <view class="habit-list">
      <view class="habit-item {{selectedHabit && selectedHabit.id === item.id ? 'selected' : ''}}" 
            wx:for="{{habits}}" 
            wx:key="id"
            bindtap="selectHabit"
            data-habit="{{item}}">
        <view class="habit-icon" style="background-color: {{item.color}}">
          <image src="{{item.icon}}" mode="aspectFit"></image>
        </view>
        <view class="habit-info">
          <text class="habit-name">{{item.name}}</text>
          <text class="habit-frequency">{{item.frequency}}</text>
        </view>
        <text class="iconfont icon-check" wx:if="{{selectedHabit && selectedHabit.id === item.id}}"></text>
      </view>
    </view>
  </view>
</view>
