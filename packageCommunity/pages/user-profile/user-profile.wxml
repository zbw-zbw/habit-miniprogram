<!--packageCommunity/pages/user-profile/user-profile.wxml-->
<view class="container">
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
  
  <!-- 用户信息 -->
  <view class="user-profile" wx:if="{{!loading && userInfo}}">
    <!-- 用户基本信息 -->
    <view class="user-header">
      <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill"></image>
      <view class="user-info">
        <text class="user-name">{{userInfo.name}}</text>
        <text class="user-bio">{{userInfo.bio}}</text>
      </view>
    </view>
    
    <!-- 关注信息 -->
    <view class="user-stats">
      <view class="stat-item" bindtap="viewFollowing">
        <text class="stat-count">{{userInfo.followingCount}}</text>
        <text class="stat-label">关注</text>
      </view>
      <view class="stat-item" bindtap="viewFollowers">
        <text class="stat-count">{{userInfo.followersCount}}</text>
        <text class="stat-label">粉丝</text>
      </view>
      <view class="stat-item">
        <text class="stat-count">{{userInfo.postsCount}}</text>
        <text class="stat-label">动态</text>
      </view>
    </view>
    
    <!-- 操作按钮 -->
    <view class="user-actions">
      <view class="action-btn {{isFollowing ? 'following' : ''}}" bindtap="toggleFollow">
        {{isFollowing ? '已关注' : '关注'}}
      </view>
      <view class="action-btn message" bindtap="sendMessage">
        发消息
      </view>
    </view>
    
    <!-- 标签页导航 -->
    <view class="tabs">
      <view class="tab-item {{activeTab === 'posts' ? 'active' : ''}}" bindtap="switchTab" data-tab="posts">
        动态
      </view>
      <view class="tab-item {{activeTab === 'habits' ? 'active' : ''}}" bindtap="switchTab" data-tab="habits">
        习惯 <text class="count">{{userInfo.habitsCount}}</text>
      </view>
      <view class="tab-item {{activeTab === 'challenges' ? 'active' : ''}}" bindtap="switchTab" data-tab="challenges">
        挑战 <text class="count">{{userInfo.challengesCount}}</text>
      </view>
    </view>
    
    <!-- 动态列表 -->
    <view class="content-section" wx:if="{{activeTab === 'posts'}}">
      <block wx:if="{{posts.length > 0}}">
        <view class="post-list">
          <view class="post-item" 
                wx:for="{{posts}}" 
                wx:key="id"
                bindtap="viewPostDetail"
                data-id="{{item.id}}">
            <view class="post-content">{{item.content}}</view>
            
            <!-- 图片展示 -->
            <view class="post-images" wx:if="{{item.images.length > 0}}">
              <block wx:if="{{item.images.length === 1}}">
                <image class="post-image single" src="{{item.images[0]}}" mode="aspectFill"></image>
              </block>
              <block wx:elif="{{item.images.length > 1}}">
                <view class="image-grid">
                  <image class="post-image multiple" 
                         wx:for="{{item.images}}" 
                         wx:for-item="img"
                         wx:key="*this"
                         src="{{img}}" 
                         mode="aspectFill"></image>
                </view>
              </block>
            </view>
            
            <!-- 互动数据 -->
            <view class="post-stats">
              <view class="post-time">{{item.createdAt}}</view>
              <view class="post-actions">
                <text class="action-item">
                  <text class="iconfont icon-like"></text> {{item.likes}}
                </text>
                <text class="action-item">
                  <text class="iconfont icon-comment"></text> {{item.comments}}
                </text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 加载更多 -->
        <view class="load-more" wx:if="{{hasMore.posts}}">
          <view class="loading-spinner small"></view>
          <text class="loading-text">加载更多...</text>
        </view>
        
        <!-- 没有更多 -->
        <view class="no-more" wx:else>
          <text>没有更多动态了</text>
        </view>
      </block>
      
      <!-- 空状态 -->
      <view class="empty-state" wx:else>
        <image class="empty-icon" src="/images/icons/empty-posts.png" mode="aspectFit"></image>
        <text class="empty-text">暂无动态</text>
      </view>
    </view>
    
    <!-- 习惯列表 -->
    <view class="content-section" wx:if="{{activeTab === 'habits'}}">
      <block wx:if="{{habits.length > 0}}">
        <view class="habit-list">
          <view class="habit-item" 
                wx:for="{{habits}}" 
                wx:key="id"
                bindtap="viewHabitDetail"
                data-id="{{item.id}}">
            <view class="habit-icon" style="background-color: {{item.color}}">
              <image src="{{item.icon}}" mode="aspectFit"></image>
            </view>
            <view class="habit-info">
              <text class="habit-name">{{item.name}}</text>
              <text class="habit-frequency">{{item.frequency}}</text>
              
              <!-- 进度条 -->
              <view class="habit-progress">
                <view class="progress-bar">
                  <view class="progress-inner" style="width: {{item.completionRate}}%"></view>
                </view>
                <text class="progress-text">{{item.completionRate}}%</text>
              </view>
            </view>
            <view class="habit-streak">
              <text class="streak-count">{{item.streak}}</text>
              <text class="streak-label">天</text>
            </view>
          </view>
        </view>
        
        <!-- 加载更多 -->
        <view class="load-more" wx:if="{{hasMore.habits}}">
          <view class="loading-spinner small"></view>
          <text class="loading-text">加载更多...</text>
        </view>
        
        <!-- 没有更多 -->
        <view class="no-more" wx:else>
          <text>没有更多习惯了</text>
        </view>
      </block>
      
      <!-- 空状态 -->
      <view class="empty-state" wx:else>
        <image class="empty-icon" src="/images/icons/empty-habits.png" mode="aspectFit"></image>
        <text class="empty-text">暂无习惯</text>
      </view>
    </view>
    
    <!-- 挑战列表 -->
    <view class="content-section" wx:if="{{activeTab === 'challenges'}}">
      <block wx:if="{{challenges.length > 0}}">
        <view class="challenge-list">
          <view class="challenge-item" 
                wx:for="{{challenges}}" 
                wx:key="id"
                bindtap="viewChallengeDetail"
                data-id="{{item.id}}">
            <image class="challenge-image" src="{{item.image}}" mode="aspectFill"></image>
            <view class="challenge-overlay"></view>
            <view class="challenge-info">
              <text class="challenge-title">{{item.title}}</text>
              <text class="challenge-participants">{{item.participants}}人参与</text>
              
              <!-- 进度条 -->
              <view class="challenge-progress">
                <view class="progress-bar">
                  <view class="progress-inner" style="width: {{item.progress}}%"></view>
                </view>
                <text class="progress-text">{{item.progress}}%</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 加载更多 -->
        <view class="load-more" wx:if="{{hasMore.challenges}}">
          <view class="loading-spinner small"></view>
          <text class="loading-text">加载更多...</text>
        </view>
        
        <!-- 没有更多 -->
        <view class="no-more" wx:else>
          <text>没有更多挑战了</text>
        </view>
      </block>
      
      <!-- 空状态 -->
      <view class="empty-state" wx:else>
        <image class="empty-icon" src="/images/icons/empty-challenges.png" mode="aspectFit"></image>
        <text class="empty-text">暂无挑战</text>
      </view>
    </view>
  </view>
  
  <!-- 用户不存在 -->
  <view class="error-state" wx:if="{{!loading && !userInfo}}">
    <image class="error-icon" src="/images/icons/error.png" mode="aspectFit"></image>
    <text class="error-text">用户不存在或已被删除</text>
    <button class="back-btn" bindtap="navigateBack">返回</button>
  </view>
</view> 
