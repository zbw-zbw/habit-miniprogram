<!--pages/community/groups/groups.wxml-->
<view class="container">
  <!-- 顶部搜索栏 -->
  <view class="search-bar {{showSearch ? 'active' : ''}}">
    <view class="search-input-container" wx:if="{{showSearch}}">
      <input class="search-input" 
             placeholder="搜索小组" 
             value="{{searchKeyword}}" 
             bindinput="inputSearch"
             bindconfirm="doSearch"
             focus="{{showSearch}}"/>
      <text class="iconfont icon-close" bindtap="hideSearchInput"></text>
    </view>
    <view class="search-icon" bindtap="showSearchInput" wx:else>
      <text class="iconfont icon-search"></text>
    </view>
    <view class="create-btn" bindtap="createGroup">
      <text class="iconfont icon-add"></text>
      <text>创建小组</text>
    </view>
  </view>
  
  <!-- 标签栏 -->
  <view class="tabs">
    <view class="tab-item {{activeTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">全部</view>
    <view class="tab-item {{activeTab === 'joined' ? 'active' : ''}}" bindtap="switchTab" data-tab="joined">已加入</view>
    <view class="tab-item {{activeTab === 'recommended' ? 'active' : ''}}" bindtap="switchTab" data-tab="recommended">推荐</view>
  </view>
  
  <!-- 小组列表 -->
  <view class="groups-list">
    <!-- 加载中 -->
    <view class="loading" wx:if="{{loading && groups.length === 0}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:elif="{{!loading && groups.length === 0}}">
      <text class="iconfont icon-empty"></text>
      <view class="empty-text">暂无小组</view>
      <button class="empty-btn" bindtap="createGroup">创建小组</button>
    </view>
    
    <!-- 小组列表 -->
    <view class="group-item" 
          wx:for="{{groups}}" 
          wx:key="id"
          bindtap="viewGroupDetail"
          data-id="{{item.id}}">
      <image class="group-cover" src="{{item.coverImage}}" mode="aspectFill"></image>
      <view class="group-info">
        <view class="group-header">
          <image class="group-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="group-meta">
            <view class="group-name">{{item.name}}</view>
            <view class="group-members">{{item.membersCount}}人</view>
          </view>
          
          <!-- 加入按钮 -->
          <button class="join-btn {{item.isJoined ? 'quit' : ''}}" 
                  catchtap="toggleJoinGroup" 
                  data-id="{{item.id}}"
                  data-index="{{index}}">
            {{item.isJoined ? '已加入' : '加入'}}
          </button>
        </view>
        
        <view class="group-description">{{item.description}}</view>
      </view>
    </view>
    
    <!-- 底部加载更多 -->
    <view class="loading-more" wx:if="{{loadingMore}}">
      <view class="loading-spinner small"></view>
      <text class="loading-text">加载更多...</text>
    </view>
    
    <!-- 没有更多数据 -->
    <view class="no-more" wx:if="{{!loading && !loadingMore && !hasMore && groups.length > 0}}">
      <text>没有更多小组了</text>
    </view>
  </view>
</view> 
