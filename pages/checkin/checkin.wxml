<!--pages/checkin/checkin.wxml-->
<view class="container">
  <!-- ç²¾ç®€çš„æ‰“å¡è¡¨å• -->
  <view class="checkin-form">
    <!-- ä¹ æƒ¯æ ‡é¢˜ -->
    <view class="habit-header">
      <view class="habit-icon" style="background-color: {{habit.color || '#4F7CFF'}}30; color: {{habit.color || '#4F7CFF'}}">
        <text class="iconfont icon-{{habit.icon || 'book'}}"></text>
      </view>
      <view class="habit-title">{{habitName}}æ‰“å¡</view>
    </view>
    
    <!-- æ—¥æœŸæ—¶é—´ -->
    <view class="form-date">{{today}} Â· å·²åšæŒ{{habit.stats.currentStreak || 0}}å¤©</view>
    
    <!-- æ—¶é•¿é€‰æ‹© -->
    <view class="form-item">
      <view class="form-label">æ—¶é•¿</view>
      <picker mode="multiSelector" value="{{durationArray.selectedIndex}}" range="{{durationArray.values}}" bindchange="onDurationChange" class="time-picker">
        <view class="time-display">{{formData.duration}}</view>
      </picker>
    </view>
    
    <!-- å†…å®¹è¾“å…¥ -->
    <view class="form-item">
      <view class="form-label">å†…å®¹</view>
      <textarea class="form-input content" placeholder="è¾“å…¥å†…å®¹" value="{{formData.content}}" bindinput="inputContent"></textarea>
    </view>
    
    <!-- æ„Ÿå—è¾“å…¥ -->
    <view class="form-item">
      <view class="form-label">ä»Šæ—¥æ„Ÿå—</view>
      <textarea class="form-textarea" placeholder="åˆ†äº«ä½ çš„æ„Ÿå—..." value="{{formData.note}}" bindinput="inputNote"></textarea>
    </view>
    
    <!-- å¿ƒæƒ…é€‰æ‹© -->
    <view class="form-item">
      <view class="form-label">ä»Šæ—¥å¿ƒæƒ…</view>
      <view class="mood-selector">
        <view class="mood-option {{formData.mood === 'great' ? 'selected' : ''}}" bindtap="selectMood" data-mood="great">
          <view class="mood-emoji">ğŸ˜Š</view>
          <view class="mood-label">è¶…æ£’</view>
        </view>
        <view class="mood-option {{formData.mood === 'good' ? 'selected' : ''}}" bindtap="selectMood" data-mood="good">
          <view class="mood-emoji">ğŸ˜Œ</view>
          <view class="mood-label">ä¸é”™</view>
        </view>
        <view class="mood-option {{formData.mood === 'neutral' ? 'selected' : ''}}" bindtap="selectMood" data-mood="neutral">
          <view class="mood-emoji">ğŸ¤”</view>
          <view class="mood-label">ä¸€èˆ¬</view>
        </view>
        <view class="mood-option {{formData.mood === 'bad' ? 'selected' : ''}}" bindtap="selectMood" data-mood="bad">
          <view class="mood-emoji">ğŸ˜´</view>
          <view class="mood-label">ä¸ä½³</view>
        </view>
        <view class="mood-option {{formData.mood === 'terrible' ? 'selected' : ''}}" bindtap="selectMood" data-mood="terrible">
          <view class="mood-emoji">ğŸ˜¢</view>
          <view class="mood-label">ç³Ÿç³•</view>
        </view>
      </view>
    </view>
    
    <!-- ç…§ç‰‡ä¸Šä¼  -->
    <view class="form-item">
      <view class="form-label">æ·»åŠ ç…§ç‰‡</view>
      <view class="photo-upload" bindtap="chooseImage" wx:if="{{formData.photos.length < 9}}">
        <text class="iconfont icon-camera"></text>
        <view class="upload-text">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</view>
      </view>
      <view class="photo-list" wx:if="{{formData.photos.length > 0}}">
        <view class="photo-item" wx:for="{{formData.photos}}" wx:key="*this">
          <image class="photo-image" src="{{item}}" mode="aspectFill"></image>
          <view class="photo-delete" bindtap="deleteImage" data-index="{{index}}">
            <text class="iconfont icon-close"></text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æäº¤æŒ‰é’® -->
    <button class="submit-btn" bindtap="submitCheckin" loading="{{submitting}}">å®Œæˆæ‰“å¡</button>
  </view>
  
  <!-- æ‰“å¡æˆåŠŸå¼¹çª— -->
  <view class="success-popup" wx:if="{{showSuccessPopup}}">
    <view class="success-popup-content">
      <view class="success-icon">âœ“</view>
      <view class="success-title">{{successMessage.title}}</view>
      <view class="success-subtitle">{{successMessage.subtitle}}</view>
      
      <view class="success-stats">
        <view class="stats-item">
          <view class="stats-value">{{successMessage.streak}}</view>
          <view class="stats-label">è¿ç»­å¤©æ•°</view>
        </view>
        <!-- æš‚æ—¶ç§»é™¤ç§¯åˆ†æ˜¾ç¤ºï¼Œåç»­å¯æ·»åŠ å›æ¥
        <view class="stats-item">
          <view class="stats-value">+{{successMessage.points}}</view>
          <view class="stats-label">ç§¯åˆ†</view>
        </view>
        -->
      </view>
      
      <view class="success-actions">
        <button class="success-btn share" open-type="share">åˆ†äº«</button>
        <button class="success-btn close" bindtap="closeSuccessPopup">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>
