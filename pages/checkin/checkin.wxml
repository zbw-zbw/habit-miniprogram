<!--pages/checkin/checkin.wxml-->
<view class="container">
  <!-- ä¸»å†…å®¹åŒº -->
  <view class="content">
    <view class="section-title">ä»Šæ—¥å¾…æ‰“å¡</view>
    
    <!-- å¾…æ‰“å¡ä¹ æƒ¯ -->
    <view class="habits-list">
      <!-- ä¸»è¦ä¹ æƒ¯ -->
      <view class="habit-card">
        <view class="habit-info">
          <view class="habit-icon" style="background-color: {{habit.color || '#4F7CFF'}}30; color: {{habit.color || '#4F7CFF'}}">
            <text class="iconfont icon-{{habit.icon || 'book'}}"></text>
          </view>
          <view class="habit-meta">
            <view class="habit-name">{{habitName || 'é˜…è¯»'}}</view>
            <view class="habit-desc">{{habit.description || 'æ¯å¤©30åˆ†é’Ÿ'}}</view>
          </view>
        </view>
        
        <view class="habit-actions">
          <view class="streak-text">å·²è¿ç»­12å¤©</view>
          <button class="checkin-btn" bindtap="toggleForm" wx:if="{{!showForm}}">æ‰“å¡</button>
          <button class="checkin-btn cancel" bindtap="toggleForm" wx:else>å–æ¶ˆ</button>
        </view>

        <!-- æ‰“å¡è¡¨å• -->
        <view class="checkin-form" wx:if="{{showForm}}">
          <view class="form-title">ä»Šæ—¥{{habitName || 'é˜…è¯»'}}</view>
          
          <!-- æ—¶é•¿è®¡æ—¶å™¨ -->
          <view class="form-item">
            <view class="form-label">{{habitName || 'é˜…è¯»'}}æ—¶é•¿</view>
            <view class="timer-display">{{timer.displayTime}}</view>
            <view class="timer-controls">
              <view class="timer-btn reset" bindtap="resetTimer">
                <text class="iconfont icon-reset"></text>
              </view>
              <block wx:if="{{timer.isRunning}}">
                <view class="timer-btn stop" bindtap="stopTimer">
                  <text class="iconfont icon-pause"></text>
                </view>
              </block>
              <block wx:else>
                <view class="timer-btn start" bindtap="startTimer">
                  <text class="iconfont icon-play"></text>
                </view>
              </block>
            </view>
          </view>
          
          <!-- å†…å®¹è¾“å…¥ -->
          <view class="form-item">
            <view class="form-label">{{habitName || 'é˜…è¯»'}}å†…å®¹</view>
            <input class="form-input" placeholder="è¾“å…¥å†…å®¹" value="{{formData.content}}" bindinput="inputContent" />
          </view>
          
          <!-- æ„Ÿå—è¾“å…¥ -->
          <view class="form-item">
            <view class="form-label">{{habitName || 'é˜…è¯»'}}æ„Ÿå—</view>
            <textarea class="form-textarea" placeholder="åˆ†äº«ä½ çš„æ„Ÿå—..." value="{{formData.note}}" bindinput="inputNote"></textarea>
          </view>
          
          <!-- å¿ƒæƒ…é€‰æ‹© -->
          <view class="form-item">
            <view class="form-label">ä»Šæ—¥å¿ƒæƒ…</view>
            <view class="mood-selector">
              <view class="mood-option {{formData.mood === 'happy' ? 'selected' : ''}}" bindtap="selectMood" data-mood="happy">
                <view class="mood-emoji">ğŸ˜Š</view>
                <view class="mood-label">å¼€å¿ƒ</view>
              </view>
              <view class="mood-option {{formData.mood === 'calm' ? 'selected' : ''}}" bindtap="selectMood" data-mood="calm">
                <view class="mood-emoji">ğŸ˜Œ</view>
                <view class="mood-label">å¹³é™</view>
              </view>
              <view class="mood-option {{formData.mood === 'thinking' ? 'selected' : ''}}" bindtap="selectMood" data-mood="thinking">
                <view class="mood-emoji">ğŸ¤”</view>
                <view class="mood-label">æ€è€ƒ</view>
              </view>
              <view class="mood-option {{formData.mood === 'tired' ? 'selected' : ''}}" bindtap="selectMood" data-mood="tired">
                <view class="mood-emoji">ğŸ˜´</view>
                <view class="mood-label">ç–²æƒ«</view>
              </view>
              <view class="mood-option {{formData.mood === 'sad' ? 'selected' : ''}}" bindtap="selectMood" data-mood="sad">
                <view class="mood-emoji">ğŸ˜¢</view>
                <view class="mood-label">éš¾è¿‡</view>
              </view>
            </view>
          </view>
          
          <!-- ç…§ç‰‡ä¸Šä¼  -->
          <view class="form-item">
            <view class="form-label">æ·»åŠ ç…§ç‰‡</view>
            <view class="photo-upload" bindtap="chooseImage" wx:if="{{formData.photos.length < 9}}">
              <text class="iconfont icon-camera"></text>
              <view class="upload-text">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</view>
            </view>
            <view class="photo-list" wx:if="{{formData.photos.length > 0}}">
              <view class="photo-item" wx:for="{{formData.photos}}" wx:key="*this">
                <image class="photo-image" src="{{item}}" mode="aspectFill"></image>
                <view class="photo-delete" bindtap="deleteImage" data-index="{{index}}">
                  <text class="iconfont icon-close"></text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- æäº¤æŒ‰é’® -->
          <button class="submit-btn" bindtap="submitCheckin">å®Œæˆæ‰“å¡</button>
        </view>
      </view>

      <!-- æ—©ç¡ä¹ æƒ¯ç¤ºä¾‹ -->
      <view class="habit-card" wx:if="{{!showForm}}">
        <view class="habit-info">
          <view class="habit-icon" style="background-color: #FB6340; opacity: 0.2; color: #FB6340;">
            <text class="iconfont icon-sleep"></text>
          </view>
          <view class="habit-meta">
            <view class="habit-name">æ—©ç¡</view>
            <view class="habit-desc">23:00å‰ç¡è§‰</view>
          </view>
        </view>
        
        <view class="habit-actions">
          <view class="streak-text">å·²è¿ç»­3å¤©</view>
          <button class="checkin-btn" style="background-color: #FB6340;">æ‰“å¡</button>
        </view>
      </view>
    </view>

    <!-- æœ¬å‘¨è¿›åº¦ -->
    <view class="section-title">æœ¬å‘¨è¿›åº¦</view>
    <view class="calendar-card">
      <view class="calendar-header">
        <view class="calendar-title">æœ¬å‘¨</view>
        <view class="calendar-action">æŸ¥çœ‹æ›´å¤š</view>
      </view>
      
      <view class="calendar-days">
        <view class="day-column" wx:for="{{weekDays}}" wx:key="weekday">
          <view class="day-label">{{item.weekday}}</view>
          <view class="day-circle {{item.isToday ? 'today' : ''}} {{item.isCompleted ? 'completed' : ''}} {{item.isDisabled ? 'disabled' : ''}}">
            {{item.day}}
          </view>
        </view>
      </view>
    </view>

    <!-- å·²å®Œæˆä¹ æƒ¯ -->
    <view class="section-title">å·²å®Œæˆ</view>
    <view class="habits-list">
      <view class="habit-card" wx:for="{{completedHabits}}" wx:key="id">
        <view class="habit-info">
          <view class="habit-icon" style="background-color: {{item.color}}30; color: {{item.color}}">
            <text class="iconfont icon-{{item.icon}}"></text>
          </view>
          <view class="habit-meta">
            <view class="habit-name">{{item.name}}</view>
            <view class="habit-desc">{{item.description}}</view>
          </view>
        </view>
        
        <view class="habit-actions">
          <view class="streak-text">å·²è¿ç»­{{index === 0 ? '8' : '5'}}å¤©</view>
          <button class="checkin-btn completed">å·²å®Œæˆ</button>
        </view>
      </view>
    </view>
  </view>
</view>
