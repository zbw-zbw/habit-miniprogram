<!--pages/index/index.wxml-->
<view class="container">
  <!-- æˆå°±è§£é”é€šçŸ¥ -->
  <achievement-unlock 
    wx:if="{{showAchievementUnlock}}" 
    achievement="{{unlockedAchievement}}" 
    visible="{{showAchievementUnlock}}"
    bind:close="hideAchievementUnlock"
    bind:view="viewAchievementDetail">
  </achievement-unlock>
  
  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯ -->
  <view class="header">
    <view class="user-info">
      <view class="avatar-wrapper">
        <image class="avatar" src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}" mode="aspectFill"></image>
      </view>
      <view class="user-detail">
        <view class="nickname">{{userInfo.nickname || 'æœªç™»å½•'}}</view>
        <view class="date">{{today}} æ˜ŸæœŸ{{weekday}}</view>
      </view>
    </view>
    <view class="motto">{{motto}}</view>
  </view>
  
  <!-- ä»Šæ—¥è¿›åº¦ -->
  <view class="progress-card">
    <view class="progress-header">
      <view class="progress-title">ä»Šæ—¥è¿›åº¦</view>
      <view class="progress-streak">å½“å‰è¿ç»­ {{currentStreak}} å¤©</view>
    </view>
    <view class="progress-body">
      <view class="progress-bar">
        <view class="progress-inner" style="width: {{completionRate}}%;"></view>
      </view>
      <view class="progress-text">{{completedCount}}/{{totalCount}} å·²å®Œæˆ</view>
    </view>
  </view>
  
  <!-- ä»Šæ—¥ä¹ æƒ¯åˆ—è¡¨ -->
  <view class="habits-card">
    <view class="section-header">
      <view class="section-title">ä»Šæ—¥ä¹ æƒ¯</view>
      <view class="section-action" bindtap="goToHabits">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    
    <view class="habits-list">
      <block wx:if="{{loading.habits || loading.stats || loading.checkins}}">
        <view class="loading">
          <view class="loading-spinner"></view>
          <view class="loading-text">åŠ è½½ä¸­...</view>
        </view>
      </block>
      <block wx:elif="{{todayHabits.length === 0}}">
        <view class="empty">
          <view class="empty-icon">ğŸ“</view>
          <view class="empty-text">ä»Šæ—¥æš‚æ— éœ€è¦å®Œæˆçš„ä¹ æƒ¯</view>
          <button class="btn btn-primary" bindtap="goToCreateHabit">åˆ›å»ºä¹ æƒ¯</button>
        </view>
      </block>
      <block wx:else>
        <habit-card 
          wx:for="{{todayHabits}}" 
          wx:key="_id" 
          habit="{{item}}" 
          stats="{{habitStats[item._id || item.id]}}"
          bindcheckin="onCheckin">
        </habit-card>
      </block>
    </view>
  </view>
  
  <!-- æ•°æ®æ¦‚è§ˆ -->
  <view class="stats-section" bindtap="goToAnalytics">
    <view class="section-header">
      <view class="section-title">æ•°æ®æ¦‚è§ˆ</view>
      <view class="section-action">æŸ¥çœ‹è¯¦æƒ…</view>
    </view>
    
    <view class="stats-grid">
      <view class="stats-item">
        <view class="stats-value">{{currentStreak}}</view>
        <view class="stats-label">å½“å‰è¿ç»­</view>
      </view>
      <view class="stats-item">
        <view class="stats-value">{{completionRateDisplay}}%</view>
        <view class="stats-label">æ€»å®Œæˆç‡</view>
      </view>
      <view class="stats-item">
        <view class="stats-value">{{totalCount}}</view>
        <view class="stats-label">ä¹ æƒ¯æ€»æ•°</view>
      </view>
    </view>
  </view>
  

  
  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <fab-button icon="add" bindclick="goToCreateHabit"></fab-button>
</view>
