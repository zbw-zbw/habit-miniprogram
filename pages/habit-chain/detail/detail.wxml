<view class="detail-page">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
  
  <block wx:else>
    <view class="chain-header">
      <view class="chain-name">{{chain.name}}</view>
      <view class="chain-description" wx:if="{{chain.description}}">{{chain.description}}</view>
      
      <view class="chain-meta">
        <view class="chain-meta-item">
          <text class="icon-text">â±ï¸</text>
          <text>{{chain.frequency.type === 'daily' ? 'æ¯æ—¥' : chain.frequency.type === 'weekly' ? 'æ¯å‘¨' : 'è‡ªå®šä¹‰'}}</text>
        </view>
        <view class="chain-meta-item">
          <text class="icon-text">ğŸ”—</text>
          <text>{{chain.habits.length}}ä¸ªä¹ æƒ¯</text>
        </view>
        <view class="chain-meta-item">
          <text class="icon-text">ğŸ“…</text>
          <text>{{formatDate(chain.createdAt)}}</text>
        </view>
      </view>
      
      <view class="action-buttons">
        <view class="action-button edit-button" bindtap="editChain">ç¼–è¾‘ä¹ æƒ¯é“¾</view>
        <view class="action-button delete-button" bindtap="deleteChain">åˆ é™¤ä¹ æƒ¯é“¾</view>
      </view>
    </view>
    
    <view class="section">
      <view class="section-title">ä¹ æƒ¯é“¾å¯è§†åŒ–</view>
      <view class="visualizer-container">
        <habit-chain-visualizer 
          chain="{{chain}}" 
          habits="{{allHabits}}" 
          editable="{{false}}"
        ></habit-chain-visualizer>
      </view>
    </view>
    
    <view class="section">
      <view class="section-title">ä¹ æƒ¯åˆ—è¡¨</view>
      <view class="habits-list">
        <view class="habit-item" wx:for="{{habitDetails}}" wx:key="habitId" bindtap="viewHabitDetail" data-id="{{item.habitId}}">
          <view class="habit-order">{{item.order}}</view>
          <view class="habit-icon" style="background-color: {{item.color || '#4F7CFF'}}">{{item.name[0]}}</view>
          <view class="habit-info">
            <view class="habit-name">{{item.name}}</view>
            <view class="habit-status {{item.isOptional ? 'optional' : ''}}">
              {{item.isOptional ? 'å¯é€‰ä¹ æƒ¯' : 'å¿…é¡»ä¹ æƒ¯'}}
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view class="section">
      <view class="section-title">å®Œæˆæƒ…å†µ</view>
      
      <view class="progress-section">
        <view class="progress-header">
          <view class="progress-title">ä»Šæ—¥è¿›åº¦</view>
          <view class="progress-date">{{today}}</view>
        </view>
        
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayProgress}}%"></view>
        </view>
        
        <view class="progress-stats">
          <view>å·²å®Œæˆ {{todayCompleted}}/{{chain.habits.length}}</view>
          <view>{{todayProgress}}%</view>
        </view>
        
        <view class="checkin-button {{canCheckin ? '' : 'disabled'}}" bindtap="checkinChain">
          {{canCheckin ? 'æ‰“å¡ä¹ æƒ¯é“¾' : 'ä»Šæ—¥å·²å®Œæˆ'}}
        </view>
      </view>
      
      <view class="calendar-container">
        <view class="calendar-header">
          <view class="calendar-title">{{year}}å¹´{{month}}æœˆ</view>
          <view class="calendar-nav">
            <view class="calendar-nav-button" bindtap="prevMonth">ä¸Šä¸ªæœˆ</view>
            <view class="calendar-nav-button" bindtap="nextMonth">ä¸‹ä¸ªæœˆ</view>
          </view>
        </view>
        
        <view class="calendar-weekdays">
          <view class="weekday" wx:for="{{weekdays}}" wx:key="*this">{{item}}</view>
        </view>
        
        <view class="calendar-days">
          <view 
            class="day {{item.isCurrentMonth ? '' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.status === 'completed' ? 'completed' : item.status === 'partial' ? 'partial' : ''}}"
            wx:for="{{calendarDays}}"
            wx:key="date"
          >
            <view class="day-inner">{{item.day}}</view>
          </view>
        </view>
      </view>
    </view>
  </block>
</view> 
